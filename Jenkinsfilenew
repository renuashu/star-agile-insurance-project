pipeline {
    agent any

tools {
  maven 'M2_HOME'
}
    stages{
        stage('checkout') {
            steps{
               echo 'checkout code from Github'
               git 'https://github.com/renuashu/star-agile-insurance-project.git'
                }
        }

    stage('package') {
            steps{
               echo 'create a package'
               sh 'mvn clean package'
                }
        }
    stage('Publish test reports') {
            steps{
               publishHTML([allowMissing: false, alwaysLinkToLastBuild: false, keepAll: false, reportDir: '/var/lib/jenkins/workspace/InsuranceProject/target/surefire-reports', reportFiles: 'index.html', reportName: 'HTML Report', reportTitles: '', useWrapperFileDirectly: true])
                }
            }

     stage('create image using package') {
            steps{
                  echo 'create a docker image from the package'
                  sh 'docker build -t renukadocker26/insurance17may:01 .'
                }
             }

   stage('push image to docker hub') {
            steps{
                  withCredentials([usernamePassword(credentialsId: 'dockerhublogin', passwordVariable: 'dockerpass', usernameVariable: 'dockeruser')]) {
                  docker push {renukadocker26/insurance17may}
                }
             }
        }
    }
}
